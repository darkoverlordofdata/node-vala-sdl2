/* Json.c generated by valac 0.34.7, the Vala compiler
 * generated from Json.gs, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <gio/gio.h>
#include <json-glib/json-glib.h>
#include <stdlib.h>
#include <string.h>


#define SDX_UTILS_TYPE_JSON (sdx_utils_json_get_type ())
#define SDX_UTILS_JSON(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SDX_UTILS_TYPE_JSON, sdxutilsJSON))
#define SDX_UTILS_JSON_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SDX_UTILS_TYPE_JSON, sdxutilsJSONClass))
#define SDX_UTILS_IS_JSON(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SDX_UTILS_TYPE_JSON))
#define SDX_UTILS_IS_JSON_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SDX_UTILS_TYPE_JSON))
#define SDX_UTILS_JSON_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SDX_UTILS_TYPE_JSON, sdxutilsJSONClass))

typedef struct _sdxutilsJSON sdxutilsJSON;
typedef struct _sdxutilsJSONClass sdxutilsJSONClass;
typedef struct _sdxutilsJSONPrivate sdxutilsJSONPrivate;
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))

struct _sdxutilsJSON {
	GObject parent_instance;
	sdxutilsJSONPrivate * priv;
};

struct _sdxutilsJSONClass {
	GObjectClass parent_class;
};


static gpointer sdx_utils_json_parent_class = NULL;

GType sdx_utils_json_get_type (void) G_GNUC_CONST;
enum  {
	SDX_UTILS_JSON_DUMMY_PROPERTY
};
JsonObject* sdx_utils_json_parse (GInputStream* stream);
sdxutilsJSON* sdx_utils_json_new (void);
sdxutilsJSON* sdx_utils_json_construct (GType object_type);


static gpointer _json_object_ref0 (gpointer self) {
	return self ? json_object_ref (self) : NULL;
}


JsonObject* sdx_utils_json_parse (GInputStream* stream) {
	JsonObject* result = NULL;
	GBufferedInputStream* st = NULL;
	GInputStream* _tmp0_ = NULL;
	GBufferedInputStream* _tmp1_ = NULL;
	GString* sb = NULL;
	GString* _tmp2_ = NULL;
	guint8* buffer = NULL;
	guint8* _tmp3_ = NULL;
	gint buffer_length1 = 0;
	gint _buffer_size_ = 0;
	gssize size = 0L;
	gboolean ready = FALSE;
	JsonParser* parser = NULL;
	JsonParser* _tmp13_ = NULL;
	JsonParser* _tmp14_ = NULL;
	GString* _tmp15_ = NULL;
	const gchar* _tmp16_ = NULL;
	JsonParser* _tmp17_ = NULL;
	JsonNode* _tmp18_ = NULL;
	JsonObject* _tmp19_ = NULL;
	JsonObject* _tmp20_ = NULL;
	GError * _inner_error_ = NULL;
	g_return_val_if_fail (stream != NULL, NULL);
	_tmp0_ = stream;
	_tmp1_ = (GBufferedInputStream*) g_buffered_input_stream_new (_tmp0_);
	st = _tmp1_;
	_tmp2_ = g_string_new ("");
	sb = _tmp2_;
	_tmp3_ = g_new0 (guint8, 100);
	buffer = _tmp3_;
	buffer_length1 = 100;
	_buffer_size_ = buffer_length1;
	ready = TRUE;
	while (TRUE) {
		gboolean _tmp4_ = FALSE;
		gssize _tmp5_ = 0L;
		GBufferedInputStream* _tmp6_ = NULL;
		guint8* _tmp7_ = NULL;
		gint _tmp7__length1 = 0;
		gssize _tmp8_ = 0L;
		gssize _tmp9_ = 0L;
		_tmp4_ = ready;
		if (!_tmp4_) {
			break;
		}
		_tmp6_ = st;
		_tmp7_ = buffer;
		_tmp7__length1 = buffer_length1;
		_tmp8_ = g_input_stream_read ((GInputStream*) _tmp6_, _tmp7_, (gsize) _tmp7__length1, NULL, &_inner_error_);
		_tmp5_ = _tmp8_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			buffer = (g_free (buffer), NULL);
			_g_string_free0 (sb);
			_g_object_unref0 (st);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		size = _tmp5_;
		_tmp9_ = size;
		if (_tmp9_ > ((gssize) 0)) {
			GString* _tmp10_ = NULL;
			guint8* _tmp11_ = NULL;
			gint _tmp11__length1 = 0;
			gssize _tmp12_ = 0L;
			_tmp10_ = sb;
			_tmp11_ = buffer;
			_tmp11__length1 = buffer_length1;
			_tmp12_ = size;
			g_string_append_len (_tmp10_, (const gchar*) _tmp11_, _tmp12_);
		} else {
			ready = FALSE;
		}
	}
	_tmp13_ = json_parser_new ();
	parser = _tmp13_;
	_tmp14_ = parser;
	_tmp15_ = sb;
	_tmp16_ = _tmp15_->str;
	json_parser_load_from_data (_tmp14_, _tmp16_, (gssize) (-1), &_inner_error_);
	if (G_UNLIKELY (_inner_error_ != NULL)) {
		_g_object_unref0 (parser);
		buffer = (g_free (buffer), NULL);
		_g_string_free0 (sb);
		_g_object_unref0 (st);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
	_tmp17_ = parser;
	_tmp18_ = json_parser_get_root (_tmp17_);
	_tmp19_ = json_node_get_object (_tmp18_);
	_tmp20_ = _json_object_ref0 (_tmp19_);
	result = _tmp20_;
	_g_object_unref0 (parser);
	buffer = (g_free (buffer), NULL);
	_g_string_free0 (sb);
	_g_object_unref0 (st);
	return result;
}


sdxutilsJSON* sdx_utils_json_construct (GType object_type) {
	sdxutilsJSON * self = NULL;
	self = (sdxutilsJSON*) g_object_new (object_type, NULL);
	return self;
}


sdxutilsJSON* sdx_utils_json_new (void) {
	return sdx_utils_json_construct (SDX_UTILS_TYPE_JSON);
}


static void sdx_utils_json_class_init (sdxutilsJSONClass * klass) {
	sdx_utils_json_parent_class = g_type_class_peek_parent (klass);
}


static void sdx_utils_json_instance_init (sdxutilsJSON * self) {
}


GType sdx_utils_json_get_type (void) {
	static volatile gsize sdx_utils_json_type_id__volatile = 0;
	if (g_once_init_enter (&sdx_utils_json_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (sdxutilsJSONClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) sdx_utils_json_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (sdxutilsJSON), 0, (GInstanceInitFunc) sdx_utils_json_instance_init, NULL };
		GType sdx_utils_json_type_id;
		sdx_utils_json_type_id = g_type_register_static (G_TYPE_OBJECT, "sdxutilsJSON", &g_define_type_info, 0);
		g_once_init_leave (&sdx_utils_json_type_id__volatile, sdx_utils_json_type_id);
	}
	return sdx_utils_json_type_id__volatile;
}



